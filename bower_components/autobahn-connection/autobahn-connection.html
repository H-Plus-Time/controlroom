<html><head><link rel="import" href="../polymer/polymer.html"><script src="../autobahnjs/autobahn.min.js"></script></head><body><dom-module id="autobahn-connection"><template></template><script>"use strict";Polymer({is:"autobahn-connection",properties:{authid:{type:String,reflectToAttribute:!0,notify:!0},session:Object,connection:{type:Object,reflectToAttribute:!0,notify:!0},methods:{type:Object,reflectToAttribute:!0,value:function(){return["cookie","wampcra"]}},realm:{type:String,reflectToAttribute:!0,value:function(){return"realm1"}},disable_url:{type:String,value:function(t){return""}},url:{type:String,reflectToAttribute:!0},endpointSuffix:{type:String,reflectToAttribute:!0,value:function(){return""}},protocolPrefix:{type:String,reflectToAttribute:!0,value:function(){return"wss"}},callables:Array},listeners:{},created:function(){},attached:function(){},_onOpen:function(t,n){this.authid=n.authid,this.fire("autobahn-auth-accepted",{session:t,details:n})},call:function(t,n){return this.connection.session.call(t,n)},subscribe:function(t,n){return this.connection.session.subscribe(t,n)},publish:function(t,n){return this.connection.session.publish(t,n)},register:function(t,n){return this.connection.session.publish(t,n)},_onClose:function(t,n){console.log("disconnected",t,n.reason,n),"wamp.error.authentication_failed"===n.reason&&this.fire("autobahn-auth-denied",{details:n}),"unreachable"===t&&this.fire("autobahn-auth-unreachable",{details:n})},connect:function(t,n){function e(t,e,o){if(console.log("onchallenge",e,o),console.log(o),"wampcra"==e)return console.log(n),autobahn.auth_cra.sign(n,o.challenge)}void 0!==this.url&&"localhost:8081"!=window.location.host||(this.url="localhost:8080");var o={url:this.protocolPrefix+"://"+this.url+"/"+this.endpointSuffix,realm:this.realm};this.methods.indexOf("wampcra")!=-1&&(o.authmethods=this.methods,o.authid=t,o.onchallenge=e),console.log(o),this.connection=new autobahn.Connection(o),this.connection.onclose=this._onClose.bind(this),this.connection.onopen=this._onOpen.bind(this),this.connection.open()}});</script></dom-module></body></html>