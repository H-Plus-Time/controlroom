box: markadams/chromium-xvfb-js
build:
  steps:
    - npm-install
    - script:
        name: bower install
        code: |
          npm install bower
          ./node_modules/bower/bin/bower install --allow-root --config.interactive=false
    - script:
        name: gulp install
        code: |
          npm install -g gulp-cli && gulp
    - script:
        name: npm test
        code: |
          xvfb-run npm test
deploy:
  steps:
    - script:
        name: basedir fix
        code: |
          cat build/unbundled/index.html | sed "s:<head>:<head><base href='https://h-plus-time.github.io/cxs-controlroom/'>:" > build/unbundled/index.html
    - leipert/git-push:
        branch: gh-pages
        gh_oauth: $GITHUB_TOKEN
        basedir: build/unbundled
