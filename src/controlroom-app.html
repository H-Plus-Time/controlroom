<html><head><link rel="import" href="../bower_components/polymer/polymer.html"><link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html"><link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html"><link rel="import" href="../bower_components/app-layout/app-header/app-header.html"><link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html"><link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html"><link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html"><link rel="import" href="../bower_components/app-route/app-location.html"><link rel="import" href="../bower_components/app-route/app-route.html"><link rel="import" href="../bower_components/iron-pages/iron-pages.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/iron-selector/iron-selector.html"><link rel="import" href="../bower_components/paper-tabs/paper-tabs.html"><link rel="import" href="../bower_components/autobahn-connection/autobahn-connection-behaviour.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"></head><body><dom-module id="controlroom-app"><template><style>:host{--app-primary-color:rgb(78, 66, 202);--app-secondary-color:black;display:block}app-header{color:#fff;background-color:var(--app-primary-color)}app-header paper-icon-button{--paper-icon-button-ink-color:white}.drawer-list{margin:0 20px}paper-tab[link] a{color:inherit;text-decoration:none;padding-left:10px;padding-right:10px;flex:1 1 auto;height:50%!important}.drawer-list a{display:block;padding:0 16px;text-decoration:none;color:var(--app-secondary-color);line-height:40px}.drawer-list a.iron-selected{color:#000;font-weight:700}div[main-title]{flex:0!important;margin:auto}app-header app-toolbar:first-of-type{align-items:flex-start}app-toolbar paper-tabs{position:absolute;right:0;text-transform:uppercase;--paper-tabs-selection-bar-color:var(--app-accent-color)}iron-pages{height:calc(100% - 128px)}</style><app-location route="{{route}}" use-hash-as-path=""></app-location><app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}"></app-route><app-drawer-layout fullbleed="" force-narrow=""><app-drawer><app-toolbar>Menu</app-toolbar><iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation"><template is="dom-repeat" items="[[menuItems]]"><a name="[[item.name]]" href="#/[[item.name]]">[[item.label]]</a></template></iron-selector></app-drawer><app-header-layout has-scrolling-region=""><app-header condenses="" reveals="" effects="waterfall"><app-toolbar><div hidden$="[[!smallScreen]]"><paper-icon-button icon="menu" drawer-toggle=""></paper-icon-button></div><div hidden$="[[smallScreen]]"><paper-tabs selected="{{routeData.page}}" attr-for-selected="name"><template is="dom-repeat" items="[[menuItems]]"><paper-tab name="[[item.name]]" link=""><a href="#/[[item.name]]">[[item.label]]</a></paper-tab></template></paper-tabs></div></app-toolbar><app-toolbar><div main-title="">Control Room</div></app-toolbar></app-header><iron-ajax auto="" url="../data/example-controllers.json" handle-as="json" last-response="{{controllers}}"></iron-ajax><iron-pages selected="[[page]]" attr-for-selected="name" fallback-selection="view404" role="main"><controlroom-home name="home" controllers="[[controllers]]"></controlroom-home><controlroom-control name="control" controllers="[[controllers]]"></controlroom-control><controlroom-telemetry name="telemetry"></controlroom-telemetry><controlroom-view404 name="view404"></controlroom-view404></iron-pages></app-header-layout></app-drawer-layout></template><script>"use strict";Polymer({is:"controlroom-app",behaviors:[AutobahnBehaviour],properties:{page:{type:String,reflectToAttribute:!0,observer:"_pageChanged"},menuItems:{type:Array,value:function(o){return[{name:"home",label:"Home"},{name:"control",label:"Control"},{name:"telemetry",label:"Telemetry"}]}},realm:{type:String,value:function(o){return"controlroom"}}},observers:["_routePageChanged(routeData.page)"],listeners:{"autobahn-opened":"initializeMeasurements","control-abort":"_dispatchAbort","control-disable":"_dispatchDisable","control-scan":"_dispatchScan","control-erase":"_dispatchErase","control-shutter-open":"_dispatchShutterOpen","control-shutter-close":"dispatchShutterClose","control-move-absolute":"_dispatchMoveAbsolute","control-move-relative":"_dispatchMoveRelative","control-home":"_dispatchHome"},_routePageChanged:function(o){this.page=o||"home"},_pageChanged:function(o){var e=this.resolveUrl("controlroom-"+o+".html");this.importHref(e,null,this._showPage404,!0)},_showPage404:function(){this.page="view404"},_dispatchAbort:function(o){this.connection.session.call("com.controlroom."+o.detail.conf.group+".abort",[])},_dispatchDisable:function(o){console.log(o),this.connection.session.call("com.controlroom."+o.detail.conf.group+"."+o.detail.conf.id+".disable",[])},_dispatchErase:function(o){console.log(o),this.connection.session.call("com.controlroom."+o.detail.conf.group+"."+o.detail.conf.id+".erase",[])},_dispatchScan:function(o){console.log(o),this.connection.session.call("com.controlroom."+o.detail.conf.group+"."+o.detail.conf.id+".scan",[o.detail.resolution])},_dispatchShutterOpen:function(o){this.connection.session.call("com.controlroom."+o.detail.conf.group+"."+o.detail.conf.id+".open",[])},_dispatchShutterClose:function(o){this.connection.session.call("com.controlroom."+o.detail.conf.group+"."+o.detail.conf.id+".close",[])},_dispatchMoveAbsolute:function(o){console.log(o),this.connection.session.call("com.controlroom."+o.detail.conf.group+"."+o.detail.conf.id+".absolute_move",[o.detail.val])},_dispatchMoveRelative:function(o){this.connection.session.call("com.controlroom."+o.detail.conf.group+"."+o.detail.conf.id+".relative_move",[o.detail.val])},_dispatchHome:function(o){this.connection.session.call("com.controlroom."+o.detail.conf.group+"."+o.detail.conf.id+".home",[o.detail.val])},attached:function(){},handle_status:function(o){this.controllers.find(function(e){return e.id==o.id}).status=o.status},echo:function(o){console.log(o)},initializeMeasurements:function(){var o,e,t=this;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return o=this.connection.session,n.next=3,regeneratorRuntime.awrap(o.subscribe("com.controlroom.measurements",this.echo));case 3:return n.next=5,regeneratorRuntime.awrap(o.subscribe("com.controlroom.status",this.handle_status));case 5:return n.next=7,regeneratorRuntime.awrap(o.call("com.controlroom.describe").then(function(o){return o}));case 7:return e=n.sent,console.log(e),n.next=11,regeneratorRuntime.awrap(Promise.all(e.map(function(e){var n;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(o.call("com.controlroom."+e+".describe").then(function(o){return o}));case 2:return n=t.sent,t.abrupt("return",n.controllers.map(function(o){return o.group=e,o}));case 4:case"end":return t.stop()}},null,t)})));case 11:x=n.sent,console.log(x),controllables=x.reduce(function(o,e){return o.concat(e)}).map(function(o){return{conf:o,telemetry:{}}}),console.log(controllables),this.controllers=controllables,console.log(this.controllers);case 17:case"end":return n.stop()}},null,this)}});</script></dom-module></body></html>